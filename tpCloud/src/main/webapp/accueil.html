<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<title>Lancer votre pétition</title>
<style type="text/css">
body { padding-top: 70px; padding-bottom:70px;}
</style>
</head>
<body>

<script src="https://unpkg.com/mithril/mithril.js"></script>
<script>
    var root = document.body

    // appel REST pour manipuler les entite

		var Petition = {
		    list: [],
		    loadList: function() {
		        return m.request({
		            method: "GET",
		            url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/petitions",
		            withCredentials: true,
		        })
		        .then(function(result) {
		        	Petition.list = result.items
		        })
		     
		    },
		   
		}
	    
		var PetitionView = {
		 		oninit: Petition.loadList,
		 	    view: function() {
		 	        return m(".user-list", Petition.list.map(function(pet) {
		                return m("main", [

		 	    		m("div",{class: "card-title",style:"width: 18rem;"},pet.nom),
		 	    		m("div",{class: "card-text"},pet.message),
			 	    	m("div",{class: "card-title pricing-card-title"},"auteur :"+pet.auteur),
			 	    	m("div",{class: "card-title pricing-card-title"},"id :"+pet.id),
			 	        m("button", {class: "btn btn-primary", onclick: function() {  console.log("iciiiii")
			 	    	   		return m.request({
		           						method: "POST",
		           						url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/signer/" + pet.id+ "/"+localStorage.getItem('userId'),    
		    						})}}, "signer"),
		 	    		 ])
		 	        }))
		 	    },
		 } 
	 var Affichage = {
	 	    view: function() {
	 	    	return m("main", [
                    m("header",
                        m("nav.menu",
                            m("ul",
                            		m("li",
                                             m("a", {class: "navbar-brand", href: "accueil.html" , style: "color: blue"},
                                                 m("strong", {class: "glyphicon glyphicon-globe", style: "color: blue"}),
                                                 "TinyPet")
                                    ),
                            		m("li", m("a", {href:"connexion.html"}, "Connexion"),),
                            		m("li",m("a", {href:"creerPetition.html"}, "Poster une petition"),),
                            		m("li",m("a", {href:"test2.html"}, "Liste des petitions"),),
                            		m("li",m("a", {href:"MesPetitions.html"}, "Mes petitions"),),
                               
                            )
                        )
                    ),
	 	           
	 	            m("h1", {class: "title"}, "Petitions récentes"),
	 	            m("div", {id: "box"}, m(PetitionView)),
	 	        ])
	 	    }
	 	}

 m.mount(root, Affichage)	

	</script>
</body>
</html>