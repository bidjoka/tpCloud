<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Accueil Tiny Pet</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>


    <script src="https://unpkg.com/mithril/mithril.js"></script>
    <script>

	var root = document.body

	var petition = {
	    list: [],
	    loadList: function() {
	        return m.request({
	            method: "GET",
	            url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/petitions"
	        })
	        .then(function(result) {
	            petition.list = result.items
	        	console.log("got:",result.items)
	        	m.redraw(true) // force
	        })
	    },
	    current: {},
	    save: function() {
	    	console.log("saving...",petition.current)
	        return m.request({
	            method: "POST",
	            url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/petition/"+petition.current.nom+"/"+petition.current.message+"/"+petition.current.auteur
	        })
	        .then(function(result) {
	        	console.log("got:",result)
	        	petition.loadList()
	        })
	    }
	}

// affichage de la liste
	var PetitionView = {
		oninit: petition.loadList,
		view: function() {
			return m(".user-list", petition.list.map(function(item) {
		    	return m ("main", [
		          	m(".user-list-item", item.nom + " " + item.message),
		           	m("button.button[type=submit][margin-top=1000px]", "Sign")
		        ])
		    }))
		},	
	}


	var Affiche ={
		view: function() {
		return m("main", [
			m("button",[m("a", {href:"creerPetition.html"}, "Créer une pétition"),]),
			m("button",[m("a", {href:"test2.html"}, "Mes pétitions"),]),
			m("button",[m("a", {href:"connexion.html"}, "Se connecter"),]),
			m("h1", "Tiny Pet"),
	 	    m("h2",  "Site de petition en ligne"),
	 	    m("p",  "Tiny Pet est un site en ligne ou vous pouvez signer des pétitions, ainsi qu'en créer."),
	 	    m("p",  "Afin de créer des pétitions, vous devrez vous connecter sur le site."),
	 	    m("p",  "Voici la liste des pétitions présentent sur le site."),
	 	    m("div", {id: "box"}, m(PetitionView)),
	 	    m("li",[m("a", {href:"index.html"}, "Liste des fonctionnalités disponibles"),]),
	 	    //m("li",[m("a", {href:"creerPetition.html"}, "Créer une pétition"),]),
	 	    
	 	    ])
	 	}
	}

	m.mount(root, Affiche)	


</script>
</body>
</html>