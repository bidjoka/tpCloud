<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Creer ma petition</title>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<script src="https://apis.google.com/js/platform.js" async defer></script>
	<meta name="google-signin-client_id" content="645573598547-h18kns51ko3p9ja3ni909jbh79p4gfv4.apps.googleusercontent.com">
</head>
<body>

	<script src="https://unpkg.com/mithril/mithril.js"></script>
	<script>	

/*formulaire pour la pétition, il faut le corrigé et trouver un moyen de passer en paramètre 
le nom de l'auteur*/
var Petition = { 
	    current: {},
	    save: function() {
	    	console.log("saving...",Petition.current)
	        return m.request({
	            method: "POST",
	            url: "https://localhost:8888/_ah/api/NotreApi/v1/petition/"+Petition.current.nom+"/"+Petition.current.message,
	            withCredentials: true, 
	        })
	    }
	}


var Form = {
		view: function() {
	        return m("form", {
	                onsubmit: function(e) {
	                    e.preventDefault()
	                    Petition.save()
	                }
	            }, [
	            m("label", "nom"),
	            m("input[type=int][placeholder=votre pétition]",{
	                oninput: function (e) {Petition.current.nom=e.target.value},
	                value: Petition.current.nom
	            }),
	            m("label", "message"),
	            m("input[type=text][placeholder=son contenu]", {
	                oninput: function (e) {Petition.current.message=e.target.value},
	                value: Petition.current.message
	            }),
	            m("button[type=submit]", "Save"),
	        ])
	    }
}
    
    //à compléter pour intégration dans le header afin de permettre la déconnexion de l'auteur
    var signout = {
             function signOut() {
	                var auth2 = gapi.auth2.getAuthInstance();
	                auth2.signOut().then(function () {
	                console.log('User signed out.');
	            });
	        }
        }

    //affichage du rendu total, il faut mettre le header
    var affiche = {
	    view: function() {
	    	return m("main", [
	            m("h1", {class: "title"}, "Créer votre pétition"),
	            m("div", {id: "form"}, m(PetitionForm)),
	            m("button", {onclick: function() {count++}}, count + " clicks"),

	        ])
	    }
	}

m.route(root, "/splash", {
    "/splash": Splash,
    "/hello": Hello,
})


</script>
</body>
</html>