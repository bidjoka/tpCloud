<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Créer ma petition</title>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<script src="https://apis.google.com/js/platform.js" async defer></script>
	<meta name="google-signin-client_id" content="645573598547-h18kns51ko3p9ja3ni909jbh79p4gfv4.apps.googleusercontent.com">
</head>
<body>




	<script src="https://unpkg.com/mithril/mithril.js"></script>
	<script>	
	var root = document.body

    var petition = {
	    list: [],
	    loadList: function() {
	        return m.request({
	            method: "GET",
	            url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/petitions"
	        })
	        .then(function(result) {
	            petition.list = result.items
	        	console.log("got:",result.items)
	        	m.redraw(true) // force
	        })
	    },
	    current: {},
	    save: function() {
	    	console.log("saving...",petition.current)
	        return m.request({
	            method: "POST",
	            url: "https://my-cloud-project-232813.appspot.com/_ah/api/myApi/v1/petition/"+petition.current.nom+"/"+petition.current.message+"/"+petition.current.auteur
	        })
	        .then(function(result) {
	        	console.log("got:",result)
	        	petition.loadList()
	        })
	    }
	}

var PetitionView = {
		oninit: petition.loadList,
	    view: function() {
	        return m(".user-list", petition.list.map(function(item) {
	            return m(".user-list-item", item.nom + " " + item.message)
	        }))
	    },
		
}

var count = 0;




var Form = {
		view: function() {
	        return m("form", {
	                onsubmit: function(e) {
	                    e.preventDefault()
	                    petition.save()
	                }
	            }, [
	            m("input.input[type=textarea][style=width:500px; height:100px;][placeholder=Nom de la pétition]",{
	                oninput: function (e) {petition.current.nom=e.target.value},
	                value: petition.current.nom
	            }),
	            m("input.input[type=textarea][style=width:500px; height:100px;][placeholder=Contenu de la pétition]", {
	                oninput: function (e) {petition.current.message=e.target.value},
	                value: petition.current.message
	            }),
                m("input.input[type=textarea][style=width:300px;][placeholder=Auteur]", {
	                oninput: function (e) {petition.current.auteur=e.target.value},
	                value: petition.current.auteur
	            }),
	            m("button.button[type=submit][style=width:150px;height:50px;]", "Sauvegarder"),
	        ])
	    }
}

var Affichage = {
	    view: function() {
	    	return m("main", [
	    		m("button",[m("a", {href:"accueil.html"}, "Accueil"),]),
				m("button",[m("a", {href:"test2.html"}, "Mes pétitions"),]),
				m("button",[m("a", {href:"connexion.html"}, "Se connecter"),]),
	            m("h1", {class: "title"}, "Création d'une pétition"),
	            m("p", "Vous pouvez soumettre une pétition."),
	            m("p", "Cette pétition doit contenir un titre, un corps, et le nom de l'auteur."),
	            m("div", {id: "form"}, m(Form)),
	            m("h4", "Liste des pétitions déjà créées"),
	            m("div", {id: "box"}, m(PetitionView)),
	            
	        ])
	    }
	}

m.mount(root, Affichage)	




</script>
</body>
</html>